<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:b="http://bootsfaces.net/ui">

<h:head>
	<!-- BOOTSTRAP -->
	<link rel="stylesheet"
		href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script
		src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script type='text/javascript'
		src="https://cdn.rawgit.com/jamesallardice/Placeholders.js/master/dist/placeholders.min.js"></script>
	<script type='text/javascript' src="resources/script/script.js"></script>
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="resources/css/style.css" />

	<title>Waterfall Startpage</title>
</h:head>
<h:body>
	<div id="navbar">
		<nav class="navbar navbar-default"> <a class="navbar-brand"
			href="#">Waterfall</a>
		<ul class="nav navbar-nav">
		</ul>
		<div class="container-fluid">
			<!--  
			<ul class="nav navbar-nav">
				<h:form id="searchForm">
					<h:commandButton action="#{userBean.search()}"
						value="Show list of all users" />
				</h:form>
			</ul>
			-->
			<ul class="nav navbar-nav navbar-right">
				<li>
					<p>#{loginControllerBean.loggedInUser.firstName}</p> <h:form
						rendered="#{loginControllerBean.loggedInUser != null}">
						<h:commandLink action="profile-page" value="Profile page"
							styleClass="link-profile-page" />
					</h:form> <h:form rendered="#{loginControllerBean.loggedInUser != null}">
						<h:commandButton value="Log out"
							action="#{loginControllerBean.logOutUser()}"
							styleClass="submit-btn" />
					</h:form> <h:form rendered="#{loginControllerBean.loggedInUser == null}">
						<h:messages></h:messages>

						<div class="login-username">
							<h:outputLabel for="username" value="Username"
								styleClass="login-label" />
							<h:inputText id="username"
								value="#{loginControllerBean.username}" required="true"
								styleClass="login-username-input" />
						</div>

						<div class="login-password">
							<h:outputLabel for="password" value="Password"
								styleClass="login-label" />
							<h:inputSecret id="password"
								value="#{loginControllerBean.password}" required="true"
								styleClass="login-password-input" />
						</div>
						<div class="login-btn-div">
							<h:commandButton action="#{loginControllerBean.loginUser()}"
								value="Login" styleClass="login-btn" />
						</div>

					</h:form> <h:form target="_blank"
						rendered="#{loginControllerBean.loggedInUser == null}">
						<h:commandLink action="reg-new-user" target="_self"
							value="Register" styleClass="link-register-new-user" />
					</h:form>
				</li>
			</ul>
		</div>
		</nav>
	</div>

	<div class="container">
		<div class="filter-div">
			<b:inputText placeholder="Filter..." styleClass="filter-input" />
			<h:commandButton
				rendered="#{loginControllerBean.loggedInUser != null}"
				class="show-create-drop-div-btn" value="Write something" />
		</div>
		<div class="create-drop-div">
			<h:form>
				<h:inputTextarea rows="5" styleClass="create-drop-input"
					value="#{dropControllerBean.content}">
				</h:inputTextarea>
				<h:commandButton styleClass="submit-btn" value="Drop it!"
					action="#{dropControllerBean.createNewDrop()}" />
			</h:form>
		</div>
		<div class="waterfall-div">
			<c:forEach var="drop" items="#{dropControllerBean.dropList}">
				<div class="test">
					<p class="waterfall-username">#{drop.owner.username}</p>
					<p class="waterfall-creation-date">#{drop.getCreationDateFormatted()}</p>
					<p class="waterfall-drop-content">#{drop.content}</p>
					<p class="comment-here-description">
						Wanna say something about this?<img class="arrow-down"
							src="resources/img/arrow-down.png" />
					</p>
					<h:form rendered="#{loginControllerBean.loggedInUser != null}">
						<h:inputText value="#{dropControllerBean.commentContent}" />
						<h:commandButton value="Comment"
							action="#{dropControllerBean.createNewComment(drop.getDropId())}" />
					</h:form>
					
					<h6>Number of comments: #{drop.getComments().size()}</h6>

 					<c:forEach var="comment" items="#{drop.getComments()}"> 
 						<p>#{comment.content}</p>

 					</c:forEach> 
				</div>
			</c:forEach>

		</div>
	</div>
</h:body>
</html>